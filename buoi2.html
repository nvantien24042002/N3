<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unit 1 ‚Äì Bu·ªïi 2 Quiz (JP ‚áÜ VI)</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f4f5fb;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }

      .app {
        width: 100%;
        max-width: 780px;
        background: #ffffff;
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.18);
        padding: 18px 20px 20px;
      }

      .app-header {
        margin-bottom: 10px;
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 7px;
      }

      .title {
        font-size: 1.2rem;
        font-weight: 700;
        color: #111827;
      }

      .subtitle {
        font-size: 0.86rem;
        color: #6b7280;
        margin-top: 2px;
      }

      .top-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 6px;
        font-size: 0.85rem;
        color: #4b5563;
      }

      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        background: #eef2ff;
        color: #4f46e5;
        font-size: 0.78rem;
        font-weight: 600;
      }

      .mode-pill {
        background: #ecfeff;
        color: #0f766e;
        margin-left: 4px;
      }

      .session-pill {
        background: #fef9c3;
        color: #854d0e;
        margin-left: 4px;
      }

      .direction-toggle,
      .session-toggle {
        display: inline-flex;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
      }

      .direction-btn,
      .size-btn {
        padding: 3px 10px;
        font-size: 0.78rem;
        border: none;
        background: transparent;
        cursor: pointer;
        color: #6b7280;
        font-weight: 600;
        white-space: nowrap;
      }

      .direction-btn.active,
      .size-btn.active {
        background: #4f46e5;
        color: #ffffff;
      }

      .progress-bar-wrapper {
        margin-top: 8px;
        width: 100%;
        height: 6px;
        border-radius: 999px;
        background: #e5e7eb;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #4f46e5, #22c55e);
        transition: width 0.2s ease;
      }

      .question-card {
        margin-top: 14px;
        padding: 14px 14px 16px;
        border-radius: 14px;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
      }

      .label {
        font-size: 0.8rem;
        font-weight: 600;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 4px;
      }

      .word {
        font-size: 1.25rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 4px;
        line-height: 1.35;
      }

      .kana {
        font-size: 0.96rem;
        color: #4b5563;
        margin-bottom: 4px;
      }

      .index {
        font-size: 0.8rem;
        color: #6b7280;
      }

      .options {
        margin-top: 14px;
        display: grid;
        gap: 8px;
      }

      .option-btn {
        width: 100%;
        text-align: left;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        background: #ffffff;
        cursor: pointer;
        font-size: 0.94rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: background 0.15s ease, box-shadow 0.15s ease,
          transform 0.04s ease, border-color 0.12s ease;
      }

      .option-btn span {
        pointer-events: none;
      }

      .option-index {
        font-size: 0.8rem;
        font-weight: 600;
        color: #9ca3af;
        margin-right: 8px;
      }

      .option-main {
        flex: 1;
        color: #111827;
      }

      .option-sub {
        font-size: 0.8rem;
        color: #6b7280;
        margin-left: 4px;
      }

      .option-btn:hover:not(:disabled) {
        background: #f3f4ff;
        box-shadow: 0 2px 6px rgba(79, 70, 229, 0.18);
        border-color: #c7d2fe;
        transform: translateY(-1px);
      }

      .option-btn.correct {
        background: #ecfdf3;
        border-color: #22c55e;
        color: #166534;
      }

      .option-btn.wrong {
        background: #fef2f2;
        border-color: #f97373;
        color: #991b1b;
      }

      .option-btn:disabled {
        cursor: default;
        opacity: 0.9;
        box-shadow: none;
        transform: none;
      }

      .feedback {
        margin-top: 12px;
        font-size: 0.9rem;
      }

      .feedback-text {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .feedback-text.correct {
        color: #15803d;
      }

      .feedback-text.wrong {
        color: #b91c1c;
      }

      .example-jp {
        font-size: 0.9rem;
        color: #111827;
        margin-bottom: 2px;
      }

      .example-vi {
        font-size: 0.86rem;
        color: #4b5563;
      }

      .summary {
        font-size: 0.85rem;
        color: #4b5563;
        margin-top: 6px;
      }

      .controls {
        margin-top: 14px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .btn {
        border-radius: 999px;
        padding: 7px 13px;
        border: none;
        cursor: pointer;
        font-size: 0.86rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 0.15s ease, box-shadow 0.15s ease,
          transform 0.04s ease, opacity 0.12s ease;
        white-space: nowrap;
      }

      .btn-primary {
        background: #4f46e5;
        color: #ffffff;
        box-shadow: 0 4px 10px rgba(79, 70, 229, 0.35);
      }

      .btn-primary:hover:not(:disabled) {
        background: #4338ca;
        box-shadow: 0 5px 12px rgba(79, 70, 229, 0.55);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: #e5e7eb;
        color: #374151;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #d1d5db;
        transform: translateY(-1px);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
        transform: none;
      }

      .footer-text {
        font-size: 0.72rem;
        color: #9ca3af;
        text-align: right;
        margin-top: 4px;
      }

      /* Stats box */
      .stats-box {
        margin-top: 14px;
        padding: 12px 12px 10px;
        border-radius: 14px;
        background: #fefefe;
        border: 1px dashed #e5e7eb;
      }

      .stats-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 6px;
      }

      .stats-subtitle {
        font-size: 0.78rem;
        color: #6b7280;
        margin-bottom: 6px;
      }

      .stats-empty {
        font-size: 0.8rem;
        color: #9ca3af;
        font-style: italic;
      }

      .stats-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
      }

      .stats-table th,
      .stats-table td {
        padding: 4px 6px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .stats-table th {
        font-weight: 600;
        color: #4b5563;
        background: #f9fafb;
      }

      .stats-tag {
        font-size: 0.7rem;
        padding: 1px 4px;
        border-radius: 999px;
        background: #fee2e2;
        color: #b91c1c;
        margin-left: 4px;
      }

      @media (max-width: 640px) {
        .app {
          padding: 14px 11px 14px;
          border-radius: 14px;
        }
        .title {
          font-size: 1.05rem;
        }
        .word {
          font-size: 1.05rem;
        }
        .options {
          gap: 6px;
        }
        .direction-btn,
        .size-btn {
          padding: 3px 7px;
        }
        .stats-table th,
        .stats-table td {
          padding: 3px 4px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header class="app-header">
        <div class="title">Unit 1 Bu·ªïi 2 (11-12-2025)</div>
        <div class="subtitle">
          Luy·ªán hai chi·ªÅu JP ‚áÜ VI ¬∑ Ch·ªçn 10/20/50 c√¢u ¬∑ L∆∞u & th·ªëng k√™ c√¢u sai
        </div>

        <div class="top-row">
          <div>
            <span class="pill" id="progressPill">C√¢u 1 / 50</span>
            <span class="pill mode-pill" id="modePill">Ch·∫ø ƒë·ªô: To√†n b·ªô</span>
            <span class="pill session-pill" id="sessionPill"
              >Phi√™n: 50 c√¢u</span
            >
          </div>
          <div>
            <span
              >ƒêi·ªÉm: <span id="scoreText">0</span> /
              <span id="answeredText">0</span></span
            >
            &nbsp;¬∑&nbsp;
            <span>ƒê√∫ng: <span id="percentText">0</span>%</span>
          </div>
        </div>

        <div class="top-row" style="margin-top: 6px">
          <div class="direction-toggle">
            <button
              class="direction-btn active"
              data-direction="vi-jp"
              id="btnViJp"
            >
              VI ‚Üí JP
            </button>
            <button class="direction-btn" data-direction="jp-vi" id="btnJpVi">
              JP ‚Üí VI
            </button>
          </div>
          <div class="session-toggle">
            <button class="size-btn" data-size="10" id="btnSize10">
              10 c√¢u
            </button>
            <button class="size-btn" data-size="20" id="btnSize20">
              20 c√¢u
            </button>
            <button class="size-btn active" data-size="50" id="btnSize50">
              50 c√¢u
            </button>
          </div>
        </div>

        <div class="top-row" style="margin-top: 4px">
          <div style="font-size: 0.78rem; color: #6b7280">
            G·ª£i √Ω: ph√≠m <b>A,B,C,D</b> ƒë·ªÉ ch·ªçn ƒë√°p √°n ¬∑ <b>Enter</b> sang c√¢u
            ti·∫øp.
          </div>
        </div>

        <div class="progress-bar-wrapper">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </header>

      <section class="question-card">
        <div class="label" id="promptLabel">Nghƒ©a ti·∫øng Vi·ªát</div>
        <div class="word" id="wordText">nam gi·ªõi</div>
        <div class="kana" id="kanaText">Ch·ªçn t·ª´ ti·∫øng Nh·∫≠t t∆∞∆°ng ·ª©ng.</div>
        <div class="index" id="indexText">
          Ch·∫ø ƒë·ªô: To√†n b·ªô 50 t·ª´ ¬∑ C√¢u 1 / 50
        </div>

        <div class="options" id="optionsContainer"></div>

        <div class="feedback" id="feedbackBox" style="display: none">
          <div class="feedback-text" id="feedbackText"></div>
          <div class="example-jp" id="exampleJp"></div>
          <div class="example-vi" id="exampleVi"></div>
          <div class="summary" id="summaryText"></div>
        </div>

        <div class="controls">
          <button class="btn btn-primary" id="nextBtn" disabled>
            ‚û° C√¢u ti·∫øp
          </button>
          <button class="btn btn-secondary" id="reviewBtn" disabled>
            üß™ √în l·∫°i c√¢u sai
          </button>
          <button class="btn btn-secondary" id="restartBtn">
            üîÅ L√†m l·∫°i (phi√™n hi·ªán t·∫°i)
          </button>
        </div>
      </section>

      <section class="stats-box" id="statsBox">
        <div class="stats-title">Top t·ª´ sai nhi·ªÅu nh·∫•t</div>
        <div class="stats-subtitle">
          Th·ªëng k√™ t·ªïng h·ª£p cho t·∫•t c·∫£ ch·∫ø ƒë·ªô & phi√™n. D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr√™n
          tr√¨nh duy·ªát c·ªßa b·∫°n.
        </div>
        <div id="statsContent" class="stats-content"></div>
      </section>

      <div class="footer-text">
        ¬© Nguy·ªÖn VƒÉn Ti·∫øn &amp; ChatGPT ‚Äì Mimi N3 Unit 1 Quiz Bu·ªïi 1
      </div>
    </div>

    <script>
      const vocabList = [
        {
          id: 51,
          kanji: "Âºï„Å£Ë∂ä„Åó",
          kana: "„Å≤„Å£„Åì„Åó",
          meaning: "vi·ªác chuy·ªÉn nh√†, d·ªçn nh√†",
          jp: "Âºï„Å£Ë∂ä„Åó„ÇíÊâã‰ºù„ÅÜ„ÄÇ",
          vi: "Gi√∫p vi·ªác chuy·ªÉn nh√†.",
        },
        {
          id: 52,
          kanji: "Ë∫´Èï∑",
          kana: "„Åó„Çì„Å°„Çá„ÅÜ",
          meaning: "chi·ªÅu cao c∆° th·ªÉ",
          jp: "Ë∫´Èï∑„ÇíÊ∏¨„Çã„ÄÇ",
          vi: "ƒêo chi·ªÅu cao.",
        },
        {
          id: 53,
          kanji: "‰ΩìÈáç",
          kana: "„Åü„ÅÑ„Åò„ÇÖ„ÅÜ",
          meaning: "c√¢n n·∫∑ng c∆° th·ªÉ",
          jp: "‰ΩìÈáç„ÇíÊ∏¨„Çã„ÄÇ",
          vi: "ƒêo c√¢n n·∫∑ng.",
        },
        {
          id: 54,
          kanji: "„Åë„Åå",
          kana: "„Åë„Åå",
          meaning: "ch·∫•n th∆∞∆°ng, b·ªã th∆∞∆°ng",
          jp: "Ëª¢„Çì„ÅßË∂≥„Å´„Åë„Åå„Çí„Åó„Åü„ÄÇ",
          vi: "T√¥i b·ªã th∆∞∆°ng ·ªü ch√¢n do v·∫•p ng√£.",
        },
        {
          id: 55,
          kanji: "‰ºö",
          kana: "„Åã„ÅÑ",
          meaning: "bu·ªïi h·ªçp, ti·ªác, s·ª± ki·ªán nh√≥m",
          jp: "ÂøòÂπ¥‰ºö„ÇíÈñã„Åè„ÄÇ",
          vi: "T·ªï ch·ª©c ti·ªác cu·ªëi nƒÉm.",
        },
        {
          id: 56,
          kanji: "Ë∂£Âë≥",
          kana: "„Åó„ÇÖ„Åø",
          meaning: "s·ªü th√≠ch, th√∫ vui",
          jp: "Ë∂£Âë≥„ÅØË™≠Êõ∏„Åß„Åô„ÄÇ",
          vi: "S·ªü th√≠ch c·ªßa t√¥i l√† ƒë·ªçc s√°ch.",
        },
        {
          id: 57,
          kanji: "ËààÂë≥",
          kana: "„Åç„Çá„ÅÜ„Åø",
          meaning: "s·ª± h·ª©ng th√∫, quan t√¢m",
          jp: "ÁßÅ„ÅØÊ≠¥Âè≤„Å´ËààÂë≥„Åå„ÅÇ„Çã„ÄÇ",
          vi: "T√¥i c√≥ h·ª©ng th√∫ v·ªõi l·ªãch s·ª≠.",
        },
        {
          id: 58,
          kanji: "ÊÄù„ÅÑÂá∫",
          kana: "„Åä„ÇÇ„ÅÑ„Åß",
          meaning: "k·ª∑ ni·ªám, h·ªìi ·ª©c",
          jp: "Êó•Êú¨„ÅßÂØåÂ£´Â±±„Å´Áôª„Å£„Åü„ÅÆ„ÅØ„ÄÅ„ÅÑ„ÅÑÊÄù„ÅÑÂá∫„Å†„ÄÇ",
          vi: "Vi·ªác leo n√∫i Ph√∫ Sƒ© ·ªü Nh·∫≠t l√† m·ªôt k·ª∑ ni·ªám ƒë·∫πp.",
        },
        {
          id: 59,
          kanji: "ÂÜóË´á",
          kana: "„Åò„Çá„ÅÜ„Å†„Çì",
          meaning: "tr√≤ ƒë√πa, l·ªùi n√≥i ƒë√πa",
          jp: "ÂÜóË´á„ÇíË®Ä„Å£„Åü„Çâ„ÄÅ„Åø„Çì„Å™„ÅåÊú¨Ê∞ó„Å´„Åó„Åü„ÄÇ",
          vi: "T√¥i n√≥i ƒë√πa m√† m·ªçi ng∆∞·ªùi l·∫°i t∆∞·ªüng th·∫≠t.",
        },
        {
          id: 60,
          kanji: "ÁõÆÁöÑ",
          kana: "„ÇÇ„Åè„Å¶„Åç",
          meaning: "m·ª•c ƒë√≠ch, m·ª•c ti√™u",
          jp: "Êó•Êú¨„Å´Êù•„ÅüÁõÆÁöÑ„ÅØÂ§ßÂ≠¶„Å∏„ÅÆÂÖ•Â≠¶„Å†„ÄÇ",
          vi: "M·ª•c ƒë√≠ch t√¥i ƒë·∫øn Nh·∫≠t l√† ƒë·ªÉ v√†o ƒë·∫°i h·ªçc.",
        },
        {
          id: 61,
          kanji: "Á¥ÑÊùü",
          kana: "„ÇÑ„Åè„Åù„Åè",
          meaning: "l·ªùi h·ª©a, cu·ªôc h·∫πn",
          jp: "ÂΩº„Å®ÁµêÂ©ö„ÅÆÁ¥ÑÊùü„Çí„Åó„Åü„ÄÇ",
          vi: "T√¥i ƒë√£ h·ª©a k·∫øt h√¥n v·ªõi anh ·∫•y.",
        },
        {
          id: 62,
          kanji: "„Åä„Åó„ÇÉ„Åπ„Çä",
          kana: "„Åä„Åó„ÇÉ„Åπ„Çä",
          meaning: "t√°n g·∫´u; ng∆∞·ªùi hay n√≥i chuy·ªán",
          jp: "ÊéàÊ•≠‰∏≠„Å´Èö£„ÅÆ‰∫∫„Å®„Åä„Åó„ÇÉ„Åπ„Çä„Åó„Å¶„ÅÑ„Å¶„ÄÅÂÖàÁîü„Å´ÊÄí„Çâ„Çå„Åü„ÄÇ",
          vi: "Trong gi·ªù h·ªçc t√¥i n√≥i chuy·ªán v·ªõi b·∫°n b√™n c·∫°nh n√™n b·ªã th·∫ßy c√¥ m·∫Øng.",
        },
        {
          id: 63,
          kanji: "ÈÅ†ÊÖÆ",
          kana: "„Åà„Çì„Çä„Çá",
          meaning: "ng·∫°i ng·∫ßn, kh√°ch s√°o, gi·ªØ √Ω",
          jp: "ÈÅ†ÊÖÆ„Åó„Å™„ÅÑ„ÅßÈ£ü„Åπ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
          vi: "ƒê·ª´ng kh√°ch s√°o, h√£y ƒÉn t·ª± nhi√™n nh√©.",
        },
        {
          id: 64,
          kanji: "ÊàëÊÖ¢",
          kana: "„Åå„Åæ„Çì",
          meaning: "ch·ªãu ƒë·ª±ng, nh·∫´n n·∫°i",
          jp: "Áóõ„Åè„Å¶„ÇÇÊàëÊÖ¢„Åô„Çã„ÄÇ",
          vi: "D√π ƒëau c≈©ng c·ªë ch·ªãu.",
        },
        {
          id: 65,
          kanji: "Ëø∑ÊÉë",
          kana: "„ÇÅ„ÅÑ„Çè„Åè",
          meaning: "phi·ªÅn ph·ª©c, g√¢y phi·ªÅn to√°i",
          jp: "‰∫∫„Å´Ëø∑ÊÉë„Çí„Åã„Åë„Å¶„ÅØ„ÅÑ„Åë„Å™„ÅÑ„ÄÇ",
          vi: "Kh√¥ng ƒë∆∞·ª£c g√¢y phi·ªÅn ph·ª©c cho ng∆∞·ªùi kh√°c.",
        },
        {
          id: 66,
          kanji: "Â∏åÊúõ",
          kana: "„Åç„Åº„ÅÜ",
          meaning: "hy v·ªçng, mong mu·ªën",
          jp: "ÁßÅ„ÅØ„Åµ„Çã„Åï„Å®„Åß„ÅÆÂ∞±ËÅ∑„ÇíÂ∏åÊúõ„Åó„Å¶„ÅÑ„Çã„ÄÇ",
          vi: "T√¥i hy v·ªçng ƒë∆∞·ª£c l√†m vi·ªác ·ªü qu√™ h∆∞∆°ng.",
        },
        {
          id: 67,
          kanji: "Â§¢",
          kana: "„ÇÜ„ÇÅ",
          meaning: "gi·∫•c m∆°; ∆∞·ªõc m∆°",
          jp: "„Åç„ÅÆ„ÅÜ„ÄÅ„Åì„Çè„ÅÑÂ§¢„ÇíË¶ã„Åü„ÄÇ",
          vi: "H√¥m qua t√¥i m∆° th·∫•y m·ªôt gi·∫•c m∆° ƒë√°ng s·ª£.",
        },
        {
          id: 68,
          kanji: "Ë≥õÊàê",
          kana: "„Åï„Çì„Åõ„ÅÑ",
          meaning: "t√°n th√†nh, ƒë·ªìng √Ω ·ªßng h·ªô",
          jp: "ÁßÅ„ÅØ„Åù„ÅÆÊèêÊ°à„Å´Ë≥õÊàê„Å†„ÄÇ",
          vi: "T√¥i t√°n th√†nh ƒë·ªÅ xu·∫•t ƒë√≥.",
        },
        {
          id: 69,
          kanji: "ÂèçÂØæ",
          kana: "„ÅØ„Çì„Åü„ÅÑ",
          meaning: "ph·∫£n ƒë·ªëi, ƒë·ªëi l·∫≠p",
          jp: "ÂΩº„ÅÆÊÑèË¶ã„Å´„ÅØÂèçÂØæ„Å†„ÄÇ",
          vi: "T√¥i ph·∫£n ƒë·ªëi √Ω ki·∫øn c·ªßa anh ·∫•y.",
        },
        {
          id: 70,
          kanji: "ÊÉ≥ÂÉè",
          kana: "„Åù„ÅÜ„Åû„ÅÜ",
          meaning: "t∆∞·ªüng t∆∞·ª£ng, h√¨nh dung",
          jp: "100Âπ¥Âæå„ÅÆÊú™Êù•„ÇíÊÉ≥ÂÉè„Åô„Çã„ÄÇ",
          vi: "H√£y t∆∞·ªüng t∆∞·ª£ng t∆∞∆°ng lai 100 nƒÉm sau.",
        },
        {
          id: 71,
          kanji: "Âä™Âäõ",
          kana: "„Å©„Çä„Çá„Åè",
          meaning: "n·ªó l·ª±c, c·ªë g·∫Øng",
          jp: "‰∏ÄÁîüÊá∏ÂëΩÂä™Âäõ„Çí„Åô„Çã„ÄÇ",
          vi: "N·ªó l·ª±c h·∫øt m√¨nh.",
        },
      ];

      // ====== DOM ELEMENTS ======
      const wordText = document.getElementById("wordText");
      const kanaText = document.getElementById("kanaText");
      const promptLabel = document.getElementById("promptLabel");
      const indexText = document.getElementById("indexText");
      const progressPill = document.getElementById("progressPill");
      const modePill = document.getElementById("modePill");
      const sessionPill = document.getElementById("sessionPill");
      const progressBar = document.getElementById("progressBar");
      const optionsContainer = document.getElementById("optionsContainer");
      const feedbackBox = document.getElementById("feedbackBox");
      const feedbackText = document.getElementById("feedbackText");
      const exampleJp = document.getElementById("exampleJp");
      const exampleVi = document.getElementById("exampleVi");
      const summaryText = document.getElementById("summaryText");
      const nextBtn = document.getElementById("nextBtn");
      const restartBtn = document.getElementById("restartBtn");
      const reviewBtn = document.getElementById("reviewBtn");
      const scoreText = document.getElementById("scoreText");
      const answeredText = document.getElementById("answeredText");
      const percentText = document.getElementById("percentText");
      const btnViJp = document.getElementById("btnViJp");
      const btnJpVi = document.getElementById("btnJpVi");
      const btnSize10 = document.getElementById("btnSize10");
      const btnSize20 = document.getElementById("btnSize20");
      const btnSize50 = document.getElementById("btnSize50");
      const statsContent = document.getElementById("statsContent");

      // ====== STATE ======
      let direction = "vi-jp"; // "vi-jp" or "jp-vi"
      let mode = "all"; // "all" or "review"
      let sessionSize = 50; // 10, 20, 50
      let mainOrder = [];
      let currentOrder = [];
      let currentIndex = 0;
      let score = 0;
      let answeredCount = 0;
      let questionLocked = false;

      // wrongSets[direction] = Set index t·ª´ v·ª±ng b·ªã sai
      const wrongSets = {
        "vi-jp": new Set(),
        "jp-vi": new Set(),
      };

      // th·ªëng k√™ t·ªïng cho t·ª´ng t·ª´
      let perVocabStats = new Array(vocabList.length)
        .fill(0)
        .map(() => ({ attempts: 0, wrongs: 0 }));

      const STORAGE_KEYS = {
        "vi-jp": "mimi_unit1_buoi_2_wrong_vi_jp",
        "jp-vi": "mimi_unit1_buoi_2_jp_vi",
      };
      const STATS_KEY = "mimi_unit1_buoi_2_stats_v1";

      // ====== HELPERS ======
      function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function saveWrongSets() {
        for (const dir of ["vi-jp", "jp-vi"]) {
          const arr = Array.from(wrongSets[dir]);
          try {
            localStorage.setItem(STORAGE_KEYS[dir], JSON.stringify(arr));
          } catch (e) {}
        }
      }

      function loadWrongSets() {
        for (const dir of ["vi-jp", "jp-vi"]) {
          try {
            const raw = localStorage.getItem(STORAGE_KEYS[dir]);
            if (raw) {
              const arr = JSON.parse(raw);
              wrongSets[dir] = new Set(arr);
            }
          } catch (e) {}
        }
      }

      function saveStats() {
        try {
          localStorage.setItem(STATS_KEY, JSON.stringify(perVocabStats));
        } catch (e) {}
      }

      function loadStats() {
        try {
          const raw = localStorage.getItem(STATS_KEY);
          if (raw) {
            const arr = JSON.parse(raw);
            if (Array.isArray(arr) && arr.length === vocabList.length) {
              perVocabStats = arr;
            }
          }
        } catch (e) {}
      }

      function updateReviewButtonState() {
        reviewBtn.disabled = wrongSets[direction].size === 0;
      }

      function updateScoreUI() {
        scoreText.textContent = String(score);
        answeredText.textContent = String(answeredCount);
        const pct =
          answeredCount === 0 ? 0 : Math.round((score / answeredCount) * 100);
        percentText.textContent = String(pct);
      }

      function updateProgressBar() {
        const total = currentOrder.length || 1;
        const pct = (currentIndex / total) * 100;
        progressBar.style.width = pct + "%";
      }

      function updateSessionPill() {
        if (mode === "review") {
          sessionPill.textContent = "Phi√™n: √în c√¢u sai";
        } else {
          sessionPill.textContent = `Phi√™n: ${sessionSize} c√¢u`;
        }
      }

      // ====== STATS UI ======
      function refreshStatsUI() {
        const items = perVocabStats
          .map((st, idx) => ({ idx, ...st }))
          .filter((x) => x.wrongs > 0)
          .sort((a, b) => {
            if (b.wrongs !== a.wrongs) return b.wrongs - a.wrongs;
            return b.attempts - a.attempts;
          })
          .slice(0, 5);

        if (items.length === 0) {
          statsContent.innerHTML =
            '<div class="stats-empty">Ch∆∞a c√≥ d·ªØ li·ªáu l·ªói. H√£y l√†m quiz ƒë·ªÉ xem t·ª´ n√†o hay sai nh√©.</div>';
          return;
        }

        let html =
          '<table class="stats-table"><thead><tr><th>#</th><th>T·ª´ ti·∫øng Nh·∫≠t</th><th>Nghƒ©a ti·∫øng Vi·ªát</th><th>Sai/T·ªïng</th><th>T·ªâ l·ªá sai</th></tr></thead><tbody>';
        items.forEach((it, rank) => {
          const v = vocabList[it.idx];
          const rate =
            it.attempts === 0 ? 0 : Math.round((it.wrongs / it.attempts) * 100);
          html += `<tr>
          <td>${rank + 1}</td>
          <td>${v.kanji}Ôºà${v.kana}Ôºâ</td>
          <td>${v.meaning}</td>
          <td>${it.wrongs} / ${it.attempts}</td>
          <td>${rate}%${
            rate >= 50 ? '<span class="stats-tag">c·∫ßn √¥n</span>' : ""
          }</td>
        </tr>`;
        });
        html += "</tbody></table>";
        statsContent.innerHTML = html;
      }

      // ====== QUIZ LOGIC ======
      function initQuiz(resetWrong = false) {
        if (resetWrong) {
          wrongSets["vi-jp"].clear();
          wrongSets["jp-vi"].clear();
          saveWrongSets();
        }
        mode = "all";
        modePill.textContent = "Ch·∫ø ƒë·ªô: To√†n b·ªô";
        updateSessionPill();

        const allIdx = vocabList.map((_, idx) => idx);
        const shuffled = shuffle(allIdx);
        const size = Math.min(sessionSize, shuffled.length);
        mainOrder = shuffled.slice(0, size);

        currentOrder = [...mainOrder];
        currentIndex = 0;
        score = 0;
        answeredCount = 0;
        updateScoreUI();
        updateReviewButtonState();
        loadQuestion();
      }

      function setDirection(newDirection) {
        if (direction === newDirection) return;
        direction = newDirection;

        if (direction === "vi-jp") {
          btnViJp.classList.add("active");
          btnJpVi.classList.remove("active");
        } else {
          btnJpVi.classList.add("active");
          btnViJp.classList.remove("active");
        }

        initQuiz(false);
      }

      function setSessionSize(newSize) {
        sessionSize = newSize;
        btnSize10.classList.toggle("active", sessionSize === 10);
        btnSize20.classList.toggle("active", sessionSize === 20);
        btnSize50.classList.toggle("active", sessionSize === 50);
        initQuiz(false);
      }

      function getPromptAndOptions(vocabIndex) {
        const vocab = vocabList[vocabIndex];

        if (direction === "vi-jp") {
          const prompt = vocab.meaning;
          const subtitle = "Ch·ªçn t·ª´ ti·∫øng Nh·∫≠t t∆∞∆°ng ·ª©ng v·ªõi nghƒ©a tr√™n.";
          const label = "Nghƒ©a ti·∫øng Vi·ªát";

          const optionsIdx = [vocabIndex];
          while (optionsIdx.length < 4) {
            const cand = Math.floor(Math.random() * vocabList.length);
            if (!optionsIdx.includes(cand)) optionsIdx.push(cand);
          }
          const shuffled = shuffle(optionsIdx).map((idx) => ({
            index: idx,
            main: vocabList[idx].kanji,
            sub: vocabList[idx].kana,
          }));

          return { prompt, subtitle, label, options: shuffled };
        } else {
          const prompt = vocab.kanji + "Ôºà" + vocab.kana + "Ôºâ";
          const subtitle = "Ch·ªçn nghƒ©a ti·∫øng Vi·ªát ƒë√∫ng.";
          const label = "T·ª´ ti·∫øng Nh·∫≠t";

          const optionsIdx = [vocabIndex];
          while (optionsIdx.length < 4) {
            const cand = Math.floor(Math.random() * vocabList.length);
            if (!optionsIdx.includes(cand)) optionsIdx.push(cand);
          }
          const shuffled = shuffle(optionsIdx).map((idx) => ({
            index: idx,
            main: vocabList[idx].meaning,
            sub: "",
          }));

          return { prompt, subtitle, label, options: shuffled };
        }
      }

      function loadQuestion() {
        feedbackBox.style.display = "none";
        feedbackText.textContent = "";
        exampleJp.textContent = "";
        exampleVi.textContent = "";
        summaryText.textContent = "";
        nextBtn.disabled = true;
        questionLocked = false;
        updateProgressBar();

        if (currentIndex >= currentOrder.length) {
          const textEnd =
            mode === "review"
              ? "ƒê√£ √¥n xong t·∫•t c·∫£ c√¢u sai trong ch·∫ø ƒë·ªô n√†y."
              : "Ho√†n th√†nh to√†n b·ªô c√¢u trong phi√™n hi·ªán t·∫°i.";
          wordText.textContent = textEnd;
          kanaText.textContent =
            wrongSets[direction].size > 0
              ? "B·∫°n c√≥ th·ªÉ b·∫•m ‚Äú√în l·∫°i c√¢u sai‚Äù ƒë·ªÉ luy·ªán ri√™ng c√°c t·ª´ hay nh·∫ßm."
              : "Kh√¥ng c√≤n c√¢u sai n√†o cho ch·∫ø ƒë·ªô n√†y. Qu√° ƒë·ªânh!";
          indexText.textContent =
            mode === "review"
              ? "Ch·∫ø ƒë·ªô: √în l·∫°i c√¢u sai"
              : `Ch·∫ø ƒë·ªô: To√†n b·ªô ¬∑ Phi√™n ${sessionSize} c√¢u`;

          optionsContainer.innerHTML = "";
          progressPill.textContent = "Xong ‚úî";
          summaryText.textContent =
            "T·ªïng k·∫øt phi√™n n√†y: ƒë√∫ng " +
            score +
            "/" +
            answeredCount +
            " c√¢u (" +
            percentText.textContent +
            "%).";
          feedbackBox.style.display = "block";
          return;
        }

        const vocabIndex = currentOrder[currentIndex];
        const vocab = vocabList[vocabIndex];
        const num = currentIndex + 1;

        const { prompt, subtitle, label, options } =
          getPromptAndOptions(vocabIndex);

        wordText.textContent = prompt;
        kanaText.textContent = subtitle;
        promptLabel.textContent = label;
        indexText.textContent =
          (mode === "review"
            ? "Ch·∫ø ƒë·ªô: √în l·∫°i c√¢u sai ¬∑ "
            : "Ch·∫ø ƒë·ªô: To√†n b·ªô ¬∑ ") + `C√¢u ${num} / ${currentOrder.length}`;
        progressPill.textContent = `C√¢u ${num} / ${currentOrder.length}`;

        optionsContainer.innerHTML = "";
        options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.innerHTML = `
          <span class="option-index">${String.fromCharCode(65 + idx)}</span>
          <span class="option-main">${opt.main}</span>
          ${
            opt.sub
              ? `<span class="option-sub">(${opt.sub})</span>`
              : '<span class="option-sub"></span>'
          }
        `;
          btn.addEventListener("click", () =>
            handleAnswer(opt.index, vocabIndex)
          );
          btn.dataset.answerIndex = idx;
          optionsContainer.appendChild(btn);
        });
      }

      function handleAnswer(chosenIndex, correctIndex) {
        if (questionLocked) return;
        questionLocked = true;
        answeredCount++;

        const buttons = optionsContainer.querySelectorAll("button");
        buttons.forEach((btn) => (btn.disabled = true));

        const correctItem = vocabList[correctIndex];
        const chosenItem = vocabList[chosenIndex];

        // C·∫≠p nh·∫≠t stats t·ªïng
        perVocabStats[correctIndex].attempts++;
        let isCorrect = chosenIndex === correctIndex;
        if (!isCorrect) {
          perVocabStats[correctIndex].wrongs++;
        }
        saveStats();
        refreshStatsUI();

        // C·∫≠p nh·∫≠t wrongSets & ƒëi·ªÉm
        if (isCorrect) {
          score++;
          if (mode === "review") {
            wrongSets[direction].delete(correctIndex);
          }
        } else {
          wrongSets[direction].add(correctIndex);
        }
        saveWrongSets();
        updateReviewButtonState();
        updateScoreUI();

        // t√¥ m√†u ƒë√°p √°n
        buttons.forEach((btn) => {
          const mainText = btn.querySelector(".option-main").textContent;
          const matchCorrect =
            mainText === correctItem.kanji || mainText === correctItem.meaning;
          const matchChosen =
            mainText === chosenItem.kanji || mainText === chosenItem.meaning;

          if (matchCorrect) {
            btn.classList.add("correct");
          } else if (matchChosen && !isCorrect) {
            btn.classList.add("wrong");
          }
        });

        feedbackBox.style.display = "block";
        if (isCorrect) {
          feedbackText.textContent = "ƒê√∫ng r·ªìi! ‚ú®";
          feedbackText.className = "feedback-text correct";
        } else {
          const rightText =
            direction === "vi-jp"
              ? `${correctItem.kanji}Ôºà${correctItem.kana}Ôºâ`
              : `${correctItem.meaning}`;
          feedbackText.textContent = `Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: „Äå${rightText}„Äç`;
          feedbackText.className = "feedback-text wrong";
        }
        exampleJp.textContent = `‰æãÊñáÔºö${correctItem.jp}`;
        exampleVi.textContent = `D·ªãchÔºö${correctItem.vi}`;

        const remainingWrong = wrongSets[direction].size;
        if (remainingWrong > 0) {
          summaryText.textContent =
            "Hi·ªán c√≤n " +
            remainingWrong +
            " t·ª´ ƒëang n·∫±m trong danh s√°ch ‚Äúc√¢u sai‚Äù ·ªü ch·∫ø ƒë·ªô " +
            (direction === "vi-jp" ? "VI ‚Üí JP" : "JP ‚Üí VI") +
            ".";
        } else {
          summaryText.textContent =
            "Kh√¥ng c√≤n t·ª´ n√†o trong danh s√°ch c√¢u sai c·ªßa ch·∫ø ƒë·ªô n√†y. Tuy·ªát v·ªùi!";
        }

        nextBtn.disabled = false;
      }

      // ====== EVENT LISTENERS ======
      nextBtn.addEventListener("click", () => {
        if (currentIndex < currentOrder.length) {
          currentIndex++;
          loadQuestion();
        }
      });

      restartBtn.addEventListener("click", () => {
        initQuiz(false);
      });

      reviewBtn.addEventListener("click", () => {
        const arr = Array.from(wrongSets[direction]);
        if (arr.length === 0) return;
        mode = "review";
        modePill.textContent = "Ch·∫ø ƒë·ªô: √în l·∫°i c√¢u sai";
        updateSessionPill();
        currentOrder = shuffle(arr);
        currentIndex = 0;
        score = 0;
        answeredCount = 0;
        updateScoreUI();
        loadQuestion();
      });

      btnViJp.addEventListener("click", () => setDirection("vi-jp"));
      btnJpVi.addEventListener("click", () => setDirection("jp-vi"));

      btnSize10.addEventListener("click", () => setSessionSize(10));
      btnSize20.addEventListener("click", () => setSessionSize(20));
      btnSize50.addEventListener("click", () => setSessionSize(50));

      // B·∫Øt ph√≠m A/B/C/D + Enter
      document.addEventListener("keydown", (e) => {
        const key = e.key.toLowerCase();
        const buttons = optionsContainer.querySelectorAll("button");
        if (!buttons.length) return;

        if (["a", "b", "c", "d"].includes(key)) {
          const idx = key.charCodeAt(0) - 97; // 'a' -> 0
          if (buttons[idx] && !buttons[idx].disabled) {
            buttons[idx].click();
          }
        } else if (key === "enter") {
          if (!nextBtn.disabled) {
            nextBtn.click();
          }
        }
      });

      // ====== START ======
      loadWrongSets();
      loadStats();
      refreshStatsUI();
      updateReviewButtonState();
      updateSessionPill();
      updateScoreUI();
      initQuiz(false);
    </script>
  </body>
</html>
